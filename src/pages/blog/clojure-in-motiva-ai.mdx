---
author: 'jon'
title: 'Clojure in Workflow Automation and AI: Motiva AI'
description: 'Workflow Orchestration with Clojure, making use of AI'
category: 'clojure-in'
layout: '../../layouts/BlogPostClojureIn.astro'
publishedDate: '2023-06-20'
heroImage: 'gresham-logo-clojurein-new.jpg'
clojureIn:
  {
    season: 'two',
    industry: 'ai',
    quote: '"Step Wise is kind of like the threading macro in Clojure on steroids."'
  }
---

////
https://deploy-preview-50--juxt-website.netlify.app/blog/clojure-in-motiva-ai/
////


import { Image } from '@astrojs/image/components'

**Jon: So Paul, welcome. Why don't you introduce yourself?**

**Paul:** Hi, I'm Paul Lam and I'm Head of Engineering at [Motiva](https://www.motiva.ai/). I feel very fortunate that this is my fourth Clojure start up. I've been doing this for 15 years now, I got on Clojure pretty early and now I'm just riding the wave.

**Jon: Tell me from the beginning.**

**Paul: I graduated in biochemical engineering in 2007, right in the financial crisis. I sent out my resume to a load of companies and ended up in the patent office of the Canadian Federal Government. It was a really simple job, relaxing with a great view!

At the same time, like many naive young people, I thought financial trading could make me some money, and I'd been doing financial trading since high school.

I got coding and trading, and one thing led to another. I participated in in algorithmic trading competitions, eventually getting invited to Geneva by the Swiss National Bank. They put me on TV and had me involved in marketing.

Through this experience people reached out to me to build systems for them.

My first start-up was building bespoke trading platforms for family fund managers based in Dubai and Hong Kong.

## Clojure?

**Jon: You were using Clojure back then?**

**Paul:** Yeah, it was 2010/2011, I was on my own and I needed something simple that I could manage myself.

**Jon: What drew you to Clojure?**

**Paul:** Java is heavy in the FinTech world and so the JVM was a given.

But I didn't like Java and all these classes. I didn't come from a specific software engineering background, I started off in computer science and switched in my 2nd semester to electrical engineering, I felt like I didn't have the training and know how to do UMLs or classes properly so I was looking for something simple.

I had a couple of options at the time; Scala or Clojure. Looking at the reference manuals, the Scala was one 700 pages long. For me the choice was clear, Clojure just clicked with me.

**Jon: Had you used lisp before?**

**Paul:** No I've not, but rewinding back I've used many programming languages. In my robotics days in particular, programming was a tool.

I was in robotics in aerospace, specifically power electronics, testing equipment and the various signals of different circuits. At the time we were working on the Airbus 380, making sure that everything was perfect all the time. They had me as a junior doing a lot of C for microcontrollers and also doing a lot of Metlab for simulations. Programming, for me, was just
a tool that I needed to be using.

## Start-ups

**Jon:** So you've done your first Clojure start-up, what happened next?

**Paul:** My partner at the time wanted to move to UK, studying for grad school. Clojure was still in it's early days and uSwitch in London was a Clojure desination, so I sent them my details on the off chance, and ended up getting a job there as  Data Scientist.

Three years later, I moved to Boston and worked with a Co-founder doing journalism data processing. It was right after the Boston bombings and we had this realisation that the primary sources of news was happening on social media; people taking pictures and posting, so we tried to surface those primary sources for journalists.

The next start-up was a chicken farming company in Mozambique. The company bought in local young people, trained them to build a profitable business so after a couple of years they could return home with education, skills and fundraising.

**Jon: It sounds like you've had a really fascinating career.**

**Paul:** I don't know what I'm doing most of the time, it's just about trying different things and not being afraid. I've had a lot of luck.

## Motiva

**Jon: Tell me about Motiva. What is it and what do you do there?**

**Paul:** Motiva is a machine learning company for enterprise email marketing. We integrate into email marketing platforms for B2B companies and we place a series of steps that they do or things that they should be doing but don't. Users don't have to move away from existing platforms, we're just a plug in on existing tools. With 7 years experience, we can see an uplift in marketing KPIs by about 50%.

In terms of the email marketing journey for an enterprise company, for example the creative stage, we provide content analysis and generation. We place NLPs and algorithms, language model, ops for deliverability which optimise what to send and when to send. We don't use any of your demographic data. We only focus on behaviours and how you're engaging with the brand and use that to build a persona for you as an individual.

**Jon: Ok, so we use MailChimp to send out a newsletter, would it help in that environment or is it a different use case?**

**Paul:** Where we differ is we focus on enterprise customers who have a multi step journey with certain goals. Royal Mail from the UK is one of our customers, along with Ford and Cisco.

## Clojure and AI

**Jon: Wow, that's really successful! Where do you make use of Clojure in the stack and what do you use for the AI?**

**Paul:** The back-end is all in Clojure, the front-end is JavaScript, and the machine learning is in Python. Python for machine learning because of the ecosystem and the people in that community. It's the people that matters; the language is a tool.

**Jon:** How do you integrate?

**Paul:** REST APIs, with [Flask](https://github.com/flask-restful/flask-restful) on top of it, nothing fancy.

That was the old version, but now [Sagemaker](https://aws.amazon.com/sagemaker/) make us Serverless. We're able to provision ML models much easier.

What really amazes me with the explosion of large language models is the entire ecosystem that has developed.

It used to be painful to deploy NLP modules, using CoreNLP, spaCey, where you download it, then they need GDK backends.. how d I build that using Docker with Python image base?

Compare this to the transformer world, everything's built for you. You choose a model, click on it in Sagemaker, it accepts any [Hugging Face](https://huggingface.co/) transformer pre-built weight. Click-click-click, and it's done! That experience to delivering from model to something in production is incomparable.

**Jon: Could you elaborate on Transformers?**

**Paul:** Transformer is the underlying architecture. LLM is the algorithm it's also the main library from [Hugging Face] (https://huggingface.co/). Hugging Face is like GitHub for new fangled language models. They host the source code and they host the actual trained modules which ends up being binary files.

You take the binary files and you can run inference. So there's two steps, one is the training. You have the algorithm and you grab a terabyte of data and train, the trained output of that is the binary file. You can take this file and run questions or apply a run time thing, they call that inference step.

Hugging Face hosts source code for free. You can see GPT 2 on there, [LLaMA from Facebook](https://ai.meta.com/blog/large-language-model-llama-meta-ai/), [Vicuna](https://lmsys.org/blog/2023-03-30-vicuna/).

## Workflow Orchestration Systems

**Jon: Tell me more about your overall architecture. What does your system look like?**

**Paul:** The biggest challenge for us is both _transactional_ and _business_ processes.

Transactional processes - such as sending out an email - being an atomic unit of action, and business process being an amalgamation of those to formulate something that matters to the business. In the case of sending out an email it could be the creative aspects of choosing who to email and dealing with regulatory compliance.

B2B companies are simply trying to solve business processes that are complicated, failure prone, long running and super messy.

The other challenge for us, is being in the cloud, which is super beneficial, but then you get more little pockets of service, that can kind of fail.

**Jon: How do you manage your processes in the cloud?**

////
33.00
////

**Paul:** For Clojure there's a couple of tracks, we like Serverless: [Lambda functions](https://aws.amazon.com/pm/lambda), [API Gateway](https://aws.amazon.com/api-gateway/), [Kinesis](https://aws.amazon.com/pm/kinesis).

One thing which is core to the entire platform for Motiva is [Step Functions](https://aws.amazon.com/step-functions/). Earlier we talked about how best to manage business processes. Microservices allow teams to be fully responsible, giving them full control over technology choices, whilst limiting the scope of what they have to worry about. Unfortunately, someone still needs to know the overall picture, how these Microservices are coordinating.

One way to resolve this is to have the workflow orchestration as actual abstraction, people have been doing that for ETL data pipelines using tools such as [Apache Airflows](https://airflow.apache.org/), with [AWS Step Functions](https://aws.amazon.com/step-functions/) being a hosted version. Step Wise is kind of like the threading macro in Clojure on steroids. It takes care of the errors in your system, giving you a high level view of errors in relationships, allowing for retries and that kind of thing.

Traceability and operational observability is a huge deal, as our processes can and do fail. We need lots of tracking and logging, and the great thing is that all of this is built into these workflow orchestration systems.

In tools like Step Wise, you can drill into the status of each step, the inputs and outputs, logging and everything. Historically it's been an ETL thing, but I actually think it's going to be more useful in the future with language models. ChatGPT is a great reasoning engine, whereby you can talk to it, give it a context and have a conversation. There's a lot of back and forth and making use of decision trees, so I believe this also a good fit for workflow orchestration automation.

[I recently published a blog](https://github.com/Motiva-AI/stepwise) about a Clojure library we use called [StepWise](https://github.com/Motiva-AI/stepwise/); a thin Clojure wrapper over step functions. It was originally built by Daniel Carlton at Reify Health using it for a bio-informatics data pipeline. We've taken it over since.

Everything is defined in EDN. Launch your Clojure process and everything just happens on step functions for you.

**Jon: Do you write the functions in Clojure? What does it look like when the step functions are executed?**

**Paul:** Yes the functions are written in Clojure.

In StepWise version 1 the functions are run in a long running process, which can be run in anything; we choose Docker.

There are two parts: 1) define the state machines and the overall flow in EDN, and 2) define the actual node/step functions.

The step functions are Clojure functions. In StepWise we run those functions in process and we kick off core async background threads whereby you can configure the concurrency setup. The process keps a running loop to pull from a specific step-function endpoint on AWS.

**Jon: Can you separate out in which process you run the various functions?**

**Paul:** Yes, we actually separate our workers, by urgent workers vs batch workers.

**Jon: For Dependencies, if I want to have a bit of code that depends on some library, how does that work?**

**Paul:** Yes, it's just Clojure, nothing stopping you.

**Jon:** It can get very expensive and complicated to distribute processes, but you seem to have the best of both worlds with this orchestration approach. If you want to you can run everything in one process, but then if you want to, you can split up the processes - you have that flexibility.

////
40
////

**Paul:** Yeah, actually as of this week, our team published a design proposal for Version 2.0 of StepWise, instead of EDN we want everything to be pure Clojure. Defining state machine is procedural programming and one of my favourite Clojure operators is the threading macro. Imagine defining a threading macro and it naturally turns into this stepwise step function distributed, serverless, orchestrated, managed thing.

Sometimes you want Lambda and sometimes you want Docker, from our experience, from using it in production, it's super tedious to keep switching, provisions etc. With wholly Lambda and some libraries it's doable For Stepwise version 1 we have it in the running process already, hosting a platform is simply a couple of lines of Clojure code, builds the flexibility. Our design is serverless first, sometimes design and load is not what we expected, Lambda has limitations, memory limits and time limits, and for some of these business processes you could be waiting on responses for days.
Version 2 is different stage use case and sometimes it's necessary to be able to swap them.

## Streaming Architectures

**Jon: Have you ever used [Storm](https://storm.apache.org/)?**

**Paul:** At USwitch I stumbled into Kafka log (Nathan Mars) and investigated Storm. One thing with Kafka Log for me I discovered this logic programming but I over used it, in hindsight I should have done some of those in streaming process. The industry has changed so much from 10 years ago, but streaming processes is something that everyone takes for granted but back in the day.

**Jon: How does Stepwise compare to Storm?**

**Paul:** One big thing with Stepwise is that we wanted it to be hosted on AWS, and secondly I just wanted it to be a library. There's only 5 operations for Stepwise.

**Jon: If someone asked you if Stepwise was a streaming architecture, would you agree?**

**Paul:** So there's two separate tracks for AWS step functions, the standard and then express state machines for up to a million interactions per second.

Quartizan.com - blog details

## Libraries

**Jon: What are your other favourite libraries, what else is in your toolkit?**

**Paul:** Lots of tooling around AWS functionalities, Stepwise, SQS, used to be Kafka, DB and tooling around on top of infrastructure products. Really like Tick'd, time library. Really like small libraries, shout out to Wes Morgan he's been maintaining Docker Clojure in my name. Manie, schema.

## Team

**Jon: How many Devs have you got?**

**Paul:** Four; three on Clojure and one on JavaScript.

**Jon:** Where abouts is Motiva based?**

TODO:

**Paul** US based, East coast, West coast, on my way from leaving the EU came to Japan, met my future wife, Covid, I would not do this again - time difference, it's not possible to do pair programming, definitely wouldn't recommend.

## State of Clojure

**Jon: What do you think of Clojure at the moment? You've been doing it for 15 years.**

**Paul**: Embarrassingly I've just been doing own my thing and have not been looking around too much. My mental model is still at Clojure 1.3 but we are in production with 1.11.2. Everything just works and you don't have to think about it.

This applies to the libraries too. Clojure doesn't operate in a vacuum, it keeps up to date, but also the eco-system, the people, the interest is still there. Big shout out to all those people out there introducing Clojure to companies, generating demand, being able to supply jobs to the community.

**Jon: It's great to publicise stories like yours showing how small teams can be very successful, and you're contributing back with source libraries. It's been great talking to you. Is there anything else you'd like to add?**

**Paul** I used to focus on hiring people who knew Clojure, from the Clojure community. I tend to back off that now as I don't want a 'fanboy', I want people who see it as a powerful tool and who are pragmatic.

**Jon: What is the Clojure scene like in Tokyo?**

**Paul**: I've been to a few meet ups, there's a few prominent Clojurians in Japan. In general the tech scene in Japan and East Asia is a few years behind the EU.

***Jon: Thank you Paul. It's been great talking to you and I've enjoyed the wonderful conversation!**
